<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link rel="stylesheet" href="styles.css?v=1">
</head>

<body>

<h1 class='ui large header'  id="trustoveriptoiptechnologyarchitecturespecification">Trust over IP (ToIP) Technology Architecture Specification</h1>
<h4 class='ui smallest header'  id="revisionhistory">Revision History</h4>
<h4 class='ui smallest header'  id="editors">Editors:</h4>
<h4 class='ui smallest header'  id="contributors">Contributors:</h4>
<p>*Copyright: *</p>
<h2 class='ui medium header'  id="1introduction">1. Introduction</h2>
<p>The mission of the <a href="https://www.trustoverip.org">Trust over IP (ToIP) Foundation</a> is to define an overall architecture for Internet-scale digital trust that combines cryptographic assurance at the machine layers (technology) with human accountability at the business, legal, and social layers (governance). Together these two halves form a complete four-layer architecture for decentralized digital trust infrastructure known as the <a href="https://trustoverip.github.io/toip/glossary#toip-stack">ToIP stack</a>. Figure 1 is a conceptual diagram of this stack:</p>
<p><img src="/images/ToIPDualStack.jpeg" alt="ToIP Dual Stack" style="width:800px;"/></p>
<p><strong>Figure 1: Conceptial diagram of the ToIP stack</strong></p>
<p>This document is the normative specification for the high-level architecture of the ToIP technology stack (the left half of Figure 1).  It is a deliverable of the <a href="https://wiki.trustoverip.org/display/HOME/Technology+Stack+Working+Group">Technology Stack Working Group</a> at the ToIP Foundation. It is recommended to read this document in conjunction with these three other documents from the ToIP Foundation in the following order:</p>
<ol>
<li class='ui item' ><p><a href="https://www.trustoverip.org/wp-content/uploads/Introduction-to-ToIP-V2.0-2021-11-17.pdf">Introduction to ToIP</a> is our white paper that provides an overall introduction to the emergence of decentralized digital trust infrastructure. It explains the origin and basic structure of the ToIP stack together with the mission and activities of the ToIP Foundation.</p></li>
<li class='ui item' ><p><a href="https://docs.google.com/document/d/1RKbHtqTRxlefkTTo4AgKW-Mwz631Z7Ufn0-oKqi9XxY/edit">Evolution of the ToIP Stack</a> is a companion document to this specification that explains the overall process the ToIP Foundation is following in the development of the ToIP stack. It is recommended for anyone seeking to understand how the work of the ToIP Foundation relates to that of adjacent non-profit organizations such as the Decentralized Identity Foundation, the OpenID Foundation, the Open Identity Exchange, and others including established SDOs such as W3C, IETF, ISO, etc. See <a href="#appendix-b-mapping-of-existing-technologies-into-the-toip-stack">Appendix B</a> for more. </p></li>
<li class='ui item' ><p><a href="https://www.trustoverip.org/wp-content/uploads/Design-Principles-for-the-ToIP-Stack-V1.0-2022-01-17.pdf">Design Principles for the ToIP Stack</a> is the immediate predecessor to this specification (see the development tracks described in <a href="#4-audience-purpose-and-scope">Section 4</a>). It enumerates the set of design principles informing, guiding, and constraining the design of the ToIP stack. We especially recommend this document for a complete understanding of this specification.</p></li>
</ol>
<p>As with all ToIP deliverables, the ToIP Foundation invites your feedback and suggestions. Please contact us via the <a href="https://www.trustoverip.org/">ToIP Foundation website</a>.</p>
<h2 class='ui medium header'  id="2terminology">2. Terminology</h2>
<p>In this document, the key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL", when appearing in ALL CAPITALS, are to be interpreted as described in <a href="https://datatracker.ietf.org/doc/html/rfc2119">IETF RFC 2119</a>.</p>
<p>All other defined terms are linked to their definitions in the applicable ToIP <a href="https://trustoverip.github.io/ctwg/glossary#glossary">glossary</a> following the process defined by the <a href="https://wiki.trustoverip.org/pages/viewpage.action?pageId=65700">ToIP Concepts and Terminology Working Group</a>(CTWG). The glossaries cited in this specification include:</p>
<ul class='ui list' >
<li class='ui item' ><a href="https://trustoverip.github.io/toip/glossary">The ToIP Core Glossary</a></li>
<li class='ui item' ><a href="https://trustoverip.github.io/ctwg/glossary">The CTWG Glossary</a></li>
<li class='ui item' ><a href="https://trustoverip.github.io/tswg/glossary">The TSWG Glossary</a></li>
<li class='ui item' ><a href="https://trustoverip.github.io/essiflab/glossary">The eSSIF-Lab Glossary</a></li>
</ul>
<p>Terms that especially vital to this specification are also explained inline.</p>
<h2 class='ui medium header'  id="3motivations">3. Motivations</h2>
<p><em>This section is informative.</em></p>
<p>The goal of this specification is to define the overall requirements for a layered system architecture that enables interoperable trust relationships between any set of endpoints on the Internet. This is directly analogous to the role the TCP/IP stack plays in enabling interoperable data exchange between any set of endpoints on the Internet. The design patterns applicable to solving these interoperability challenges, and the motivations for each, are detailed at length in <a href="https://trustoverip.org/permalink/Design-Principles-for-the-ToIP-Stack-V1.0-2022-11-17.pdf">Design Principles for the ToIP Stack</a>.</p>
<p>Whether from the perspective of an implementer, a customer, or a policymaker, there are many benefits to a well-defined layered architecture:</p>
<ul class='ui list' >
<li class='ui item' ><p><strong>Engineering stability.</strong> The abstraction of bundling technologies and policies within distinct layers isolates changes within a layer from interactions and dependencies between layers. The result is a framework more resilient to structural changes than when the layers are not separated.</p></li>
<li class='ui item' ><p><strong>Wide adoption through a principled trust spanning layer.</strong> The TCP/IP stack features a simple minimalistic protocol (the <a href="https://en.wikipedia.org/wiki/Internet_Protocol">Internet Protocol</a>) as a universal spanning layer. More diverse task-specific protocols are built on top of this spanning layer (e.g., TCP for connection-oriented, UDP for connectionless). In the case of ToIP, a trust spanning layer based on a well-grounded set of design principles can maximize adoption, interoperability and reachability.</p></li>
<li class='ui item' ><p><strong>Reliability.</strong> A well-defined architecture enables the development of software components and applications that can be trusted to act in predictable, reliable ways—and that can expect other components and applications to do the same.</p></li>
<li class='ui item' ><p><strong>Interoperability and vendor independence.</strong> As with the TCP/IP stack, the Bluetooth stack, the NFC stack, or other protocol stacks, implementations from multiple vendors can and should be interoperable, both with current standards, and as they evolve over time. Customers should be able to switch between them without major loss of functionality.</p></li>
<li class='ui item' ><p><strong>Development communities.</strong> A well-designed architecture stack helps spawn a robust, diverse community of developers building solutions whose interoperability depends on a core stack. More development attracts more innovation, more innovation attracts more adoption, producing a network effect benefiting the entire ecosystem.</p></li>
<li class='ui item' ><p><strong>Commoditization.</strong> Standardization of a stack for mass adoption commoditizes it, reducing both the cost of implementation and the time to market. It also frees vendors to focus on their proprietary differentiation in their service offerings.</p></li>
<li class='ui item' ><p><strong>Public policy.</strong> A well-defined architecture with clear and concise terminology helps policymakers and legal experts define coherent policies and regulations in a manner that serves the needs of society without constraining technical innovation and competition. </p></li>
</ul>
<h2 class='ui medium header'  id="4audiencepurposeandscope">4. Audience, Purpose and Scope</h2>
<p><em>This section is informative.</em></p>
<p>The audience for this specification is protocol designers, system architects, software developers and product managers who wish to understand, influence, design, develop, or implement interoperable decentralized digital trust infrastructure, services, or applications.</p>
<p>The purpose of is specification is to define a reference architecture for the technology side of the ToIP stack, including the functions and behaviors required for each of the four layers and the functional and behavioral inter-dependencies between the layers:
     - What each layer must do.
     - What each layer should and may do.
     - What behaviors are expected to support interoperability.
     - What interactions each layer supports for other layers.</p>
<p>The goal of these architectural requirements is to inform subsequent development tracks as summarized in Figure 2:</p>
<p><img src="/images/StackDevTrack.png" alt="ToIP Stack Development Track" style="width:800px;"/></p>
<p><strong>Figure 2: The planned progression of development tracks for the ToIP Technology Stack</strong></p>
<p>For more information about the interrelationship and progression of these four development tracks, please see Appendix B: Evolution of the ToIP Stack. </p>
<p>The scope of this specification is limited to the Technical Architecture Track above, i.e., to defining the normative architectural requirements needed to guide the Component Specification Track. Success will be achieved if these requirements are sufficient to produce the component specifications needed to implement the architecture and prepare for the Interoperability Testing Track. </p>
<p>By focusing solely on the Technical Architecture Track, the following are explicitly out-of-scope:</p>
<ol>
<li class='ui item' >The definition of specific protocols or interfaces at each layer (these will be produced in the Component Specifications Track).</li>
<li class='ui item' >The definition of specific interoperability profiles and test cases—including both vertical and horizontal interoperability—that can be used for commercial-grade test harnesses and testing labs (these will be produced in the Interoperability Testing Track).</li>
<li class='ui item' >The definition of specific intermediary systems or supporting systems for any layer.</li>
<li class='ui item' >The definition of specific applications (and their user interfaces) that run on top of the ToIP stack.</li>
<li class='ui item' >The definition of ToIP Governance Stack components such as trust frameworks or governance frameworks for usage of the ToIP stack within specific digital trust ecosystems.</li>
</ol>
<p><em>NOTE: We do not expect all of these additional deliverables, especially the component specifications, to be produced by the ToIP Technology Stack Working Group (or other ToIP Working Groups). Some have already been produced—and others are in development—by other standards development organizations (such as the Decentralized Identity Foundation, W3C, IETF, ETSI, and ISO), independent governing authorities, and independent developers.</em></p>
<p><em>NOTE: Due to the public policy implications, the ToIP Foundation is committed to producing a companion document called <strong>ToIP Primer for Policymakers</strong>. This document will guide policymakers, governing authorities, analysts, and other non-technical audiences who need to deeply understand the purpose, uses, and implications of the ToIP stack but do not need (or want) to dive into technical details.</em></p>
<h2 class='ui medium header'  id="5exampleusecases">5. Example Use Cases</h2>
<p><em>This section is informative.</em></p>
<h2 class='ui medium header'  id="6referencearchitectureoverview">6. Reference Architecture Overview</h2>
<p><em>This section is informative.</em></p>
<h3 class='ui small header'  id="61designgoals">6.1 Design Goals</h3>
<p>A reference architecture of a complex system is an abstract framework consisting of a list of functional subsystems together with the interfaces and protocols needed to define the potential interactions and dependencies between these systems and/or external systems. This reference architecture provides a logical articulation of these interfaces and protocols which can then be translated into specific component specifications as described in Figure 2.</p>
<p>Such a reference architecture is an exercise in design guided by a set of most significant goals or principles. The overarching goals for the ToIP stack are twofold:</p>
<ol>
<li class='ui item' >Define a general means of establishing trust between any two or more endpoint systems,</li>
<li class='ui item' >Achieve universal interoperability among implementations.</li>
</ol>
<p>These twin objectives led the ToIP Foundation to begin the work with the Design Principles Track in Figure 2. In 2021, we developed a set of 17 <a href="https://www.trustoverip.org/wp-content/uploads/Design-Principles-for-the-ToIP-Stack-V1.0-2022-01-17.pdf">Design Principles for the ToIP Stack</a> that are the basis for the design choices reflected in this specification. For the full rationale behind each design principle, see <a href="https://www.trustoverip.org/wp-content/uploads/Design-Principles-for-the-ToIP-Stack-V1.0-2022-01-17.pdf">Design Principles for the ToIP Stack</a>.</p>
<p>With regard to the first design goal, establishing trust between parties requires that each party develop confidence in the following properties of their relationship:</p>
<ol>
<li class='ui item' ><strong>Authenticity:</strong> is the receiver of a communication able to verify that it originated from the expected sender?</li>
<li class='ui item' ><strong>Integrity:</strong> is the receiver able to verify that a communication is complete and has not been tampered with?</li>
<li class='ui item' ><strong>Confidentiality:</strong> is the contents of a communication protected so only authorized parties have access?</li>
<li class='ui item' ><strong>Privacy:</strong> will the expectations of each party with respect to usage of shared information be honored by the other parties?</li>
</ol>
<p>Note that, in some trust relationships, confidentiality and privacy may be optional. Thus our design goal with the ToIP stack is to achieve these four properties in the order listed.[^1]</p>
<p>[^1]: Another standard information trust criteria is <strong>availability</strong>. This is a concern with the design and implementation of operational deployments of the ToIP stack and should be addressed in the associated operational governance frameworks.</p>
<p>With regard to the second design goal, the ToIP reference architecture shares the same goal of global scalability as the original Internet architecture. This involves several intertwined considerations that overlap and reinforce each other as summarized by the first four <a href="https://www.trustoverip.org/wp-content/uploads/Design-Principles-for-the-ToIP-Stack-V1.0-2022-01-17.pdf">Design Principles for the ToIP Stack</a>:</p>
<ol>
<li class='ui item' >The End-to-End Principle</li>
<li class='ui item' >Connectivity Is Its Own Reward (Universal Interoperability)</li>
<li class='ui item' >The Hourglass Model</li>
<li class='ui item' >Decentralization</li>
</ol>
<h3 class='ui small header'  id="62thefourlayerpattern">6.2 The Four Layer Pattern</h3>
<p>Together these considerations lead to the general <em>four-layer pattern</em> of a protocol stack summarized in Table 1.</p>
<p>| Leyer # | Generic Name | ToIP Name |
|---------|--------------|-----------|
| 4       | Applications | Trust Applications |
| 3       | Supported protocols | Trust Tasks |
| 2       | Spanning protocol | Trust Spanning |
| 1       | Supporting protocols | Trust Support |</p>
<p><strong>Table 1: The four layer pattern of large-scale protocol stacks</strong></p>
<p>The best-known example of this four-layer pattern is the TCP/IP Internet protocol stack, where any number of local area networking protocols at Layer 1 support a single spanning layer protocol—the IP protocol—at Layer 2. This spanning layer in turn supports multiple higher-level protocols at Layer 3 (e.g., TCP, UDP, HTTP, SMTP) designed to meet the needs of many different applications at Layer 4.</p>
<p>Much of the success of the Internet is attributed to this “hourglass” design in which the spanning layer protocol maximizes interoperability by providing a common way for all the higher level layers to communicate with all the lower level layers. This is why the design of the trust spanning layer should be “as simple as possible but no simpler”. Figure 3 illustrates how this same hourglass design applies to the four ToIP layers.</p>
<p><img src="/images/HourGlass.png" alt="Four layer pattern in the hourglass model" style="width:500px;"/></p>
<p><strong>Figure 3: How the four layer pattern fits the Hourglass Model</strong></p>
<p>A more detailed overview showing where different decentralized digital trust infrastructure functions fall relative to the trust spanning layer is shown in Figure 4.</p>
<p><img src="/images/ExampleStack.png" alt="Examples of what falls above and below the trust spanning layer" style="width:800px;"/></p>
<p><strong>Figure 4: Examples of what falls above and below the trust spanning layer</strong></p>
<h3 class='ui small header'  id="63highlevelsystemarchitecture">6.3 High-Level System Architecture</h3>
<p>The reference architecture of the ToIP stack provides a generalization of different solutions to trust establishment over the Internet (or over other digital networks). This section introduces the basic concepts, requirements and vocabulary with which to consider: a) each functional component, b) the interface definitions and protocols between these components, and c) interoperability of solutions built upon those components. Subsequent sections will describe these components and protocols in more detail.</p>
<p>At the highest level, ToIP interactions occur between three basic types of interacting systems.</p>
<ol>
<li class='ui item' ><strong>Endpoint Systems</strong> (often simply referred to as Endpoints): the ToIP systems between which end-to-end trust is enabled following the End-to-End Principle. See <a href="#71-endpoint-systems">Section 7.1</a>.</li>
<li class='ui item' ><strong>Intermediary Systems</strong> may be used to assist in the interactions between the Endpoint Systems. In that context, Intermediary systems are involved in the ToIP Trust Spanning Protocol, and may themselves be Endpoint Systems. Intermediary systems are not a dependency to Endpoint systems' trust relationship. See <a href="#9-intermediary-systems">Section 9</a>.</li>
<li class='ui item' ><strong>Supporting Systems</strong> are typically required to support the definition of Endpoints and trust establishment between Endpoint Systems. Supporting Systems that facilitate the authenticity and autonomy of an Endpoint System are termed “Privileged” Supporting Systems, others are “Unprivileged” (see <a href="#101-overview">Section 10.1</a>). Supporting Systems are not directly involved in the ToIP Trust Spanning Protocol. See <a href="#10-supporting-systems">Section 10</a>.</li>
</ol>
<p>The relationships between these systems is shown in Figure 5.</p>
<p><img src="/images/ThreeTypesofSystems.png" alt="Three Types of Systems" style="width:600px;"/></p>
<p><strong>Figure 5: The three basic types of component systems in ToIP architecture</strong></p>
<p>The definition of each system is anchored to its defined (and agreed) locus of control, i.e., who is able to exert control over the operation of that system. Clarity about the locus of control and the dependencies between systems is critical as end-to-end trust is constructed between any two Endpoint Systems. Each system, whether it is classified as an Endpoint System, Intermediary System or Supporting System, defines its own locus of control. An Endpoint System, for example, may be a tiny IoT device, a personal smartphone, or a large capacity service hosted in a cloud. What matters to the architecture is that it exhibits a consistent locus of control and, therefore, consistent interaction protocols with respect to other systems. </p>
<p>These subsystems collaborate with each other through three types of consistent ToIP interactions:</p>
<ol>
<li class='ui item' >Endpoint System to Endpoint System</li>
<li class='ui item' >Endpoint System to Supporting Systems</li>
<li class='ui item' >Endpoint System to Intermediary Systems</li>
</ol>
<p>ToIP Endpoint Systems and their interactions follow the 4-layer design pattern described in <a href="#62-the-four-layer-pattern">Section 6.2</a>. As we move up the stack (to Layers 3 and 4), the roles that may be played by an Endpoint System are often given more context-specific names. For example, at Layer 3, an Endpoint System involved in the Trust Task of exchanging <a href="https://www.w3.org/TR/vc-data-model/">verifiable credentials</a> may be classified as an “Issuer”, “Holder”, or “Verifier” in that specific interaction context. These higher layer terms are specific to that context and must be consistent with the abstract general terms used in this reference architecture.</p>
<p>Figure 6 shows a high level view of how these three basic types of component systems might interact using the existing infrastructure of the Internet.</p>
<p><img src="/images/HighLevelView.png" alt="High level view of ToIP consistent system interactions" style="width:800px;"/></p>
<p><strong>Figure 6: High level view of ToIP consistent system interactions</strong></p>
<p>The normative requirements for each type of subsystem and interaction across the ToIP layers are specified in the following sections.</p>
<h3 class='ui small header'  id="64toipidentifiers">6.4 ToIP Identifiers</h3>
<p>Just as IP addresses are the heart of the Internet TCP/IP stack, ToIP identifiers are the heart of the ToIP stack. Figure 7 illustrates the three basic types of ToIP identifiers.</p>
<p><img src="/images/IdentifierTypes.png" alt="Three classes of identifiers" style="width:800px;"/></p>
<p><strong>Figure 7: The three classes of identifiers used with ToIP architecture</strong></p>
<p>Design Principle #5 (<a href="https://trustoverip.org/permalink/Design-Principles-for-the-ToIP-Stack-V1.0-2022-11-17.pdf">Cryptographic Verifiability</a>) states that “messages and data structures exchanged between parties should be verifiable as authentic using standard cryptographic algorithms and protocols”. This requires that Endpoint Systems be able to associate, discover and verify the cryptographic keys associated with a ToIP identifier. This specification will refer to identifiers that meet this basic requirement of cryptographic verifiability as verifiable identifiers (VIDs). </p>
<p>VIDs divide into two subclasses: those that rely on centralized registries, and those that do not. An example of the former is the authority portion of an HTTPS URL. It relies on a centralized DNS registry for resolution, but that domain name is associated with an X.509 digital certificate that provides a cryptographic binding with a public key.</p>
<p>VIDs that do not require a centralized registry are known as decentralized identifiers or DIDs. DIDs fulfill the requirement of Design Principle #4 (<a href="https://trustoverip.org/permalink/Design-Principles-for-the-ToIP-Stack-V1.0-2022-11-17.pdf">Decentralization by Design and Default</a>). The W3C has established a global standard for the syntax and resolution format of <a href="https://www.w3.org/TR/did-core/">DIDs</a>.</p>
<p>DIDs can be further subdivided into two classes: those whose verification requires the use of an external system outside of the autonomy boundary of the DID controller, and those whose verification can be accomplished using cryptography alone. The latter are often called self-certifying identifiers. Since self-certifying identifiers enable an Endpoint System to be completely autonomous, this specification will refer to this class of identifiers as autonomous identifiers (AIDs). A <a href="https://github.com/SmithSamuelM/Papers/blob/master/whitepapers/KERI_WP_2.x.web.pdf">KERI autonomic identifier</a> is an example of an AID.</p>
<p>Requirements for ToIP identifiers are covered in <a href="#82-identifiers">Section 8.2</a>.</p>
<h2 class='ui medium header'  id="7endpointsystemsandthelayeredstack">7. Endpoint Systems and the Layered Stack</h2>
<p><em>This section is normative.</em></p>
<h3 class='ui small header'  id="71endpointsystems">7.1 Endpoint Systems</h3>
<p>Endpoint Systems represent ToIP systems that are under a party’s direct control. A party means the entity that is evaluating, relying on, and benefiting from a trust relationship. In other words, a party is any user of the system without regard to their role in the system. This represents a contrast with the traditional identity and access management (IAM) distinct roles of a user who is making trust assertions and a <em>relying party</em> who is relying on those assertions to make a trust decision. In a ToIP system, Endpoint Systems have a symmetric <em>peer-to-peer</em> trust relationship in Layer 2 — the trust spanning layer.</p>
<p>Endpoint Systems are autonomous in the sense that a party’s locus of control is fully contained within the given Endpoint System. This means a potential compromise of other Endpoint Systems, Intermediary Systems, or Supporting Systems will not directly compromise the integrity of a given Endpoint System. Each Endpoint System can be simple or very complex, i.e., it may have many further divided functions and/or services, however in this reference architecture, we shall consider the abstract Endpoint System autonomous. Implementers SHOULD ensure autonomy for Endpoint Systems [REQ A.1]</p>
<p>Common examples of Endpoint Systems include:</p>
<ul class='ui list' >
<li class='ui item' >A mobile phone owned and administered by an individual.</li>
<li class='ui item' >A merchant’s web server (on-premise or in the cloud), administered by the merchant.</li>
<li class='ui item' >A financial institution’s distributed digital services, including certain online services for trust functions, administered by the financial institution.</li>
<li class='ui item' >An IoT pollution sensor device owned and administered by a city.</li>
</ul>
<p>Befitting Design Principle #1 (<a href="https://trustoverip.org/permalink/Design-Principles-for-the-ToIP-Stack-V1.0-2022-11-17.pdf">The End-to-End Principle</a>), Endpoint Systems are the ultimate targets of the requirements of ToIP architecture. They are likely to be much larger in number — by several magnitudes — compared to Intermediary or Supporting Systems. They implement most of the functions in the ToIP architecture and represent the biggest challenge for interoperability and scalability.</p>
<p><img src="/images/EndpointSystem.png" alt="Endpoint System" style="width:400px;"/></p>
<p><strong>Figure 8: Endpoint System</strong></p>
<p>Within an Endpoint System, a higher layer uses the functions of a lower layer through an <strong>Interface</strong>. In ToIP architecture, functions within an Endpoint System are decomposed into layers in a vertical stack where layer boundaries are defined by their corresponding Interfaces. In a ToIP Endpoint System, the higher layers of the ToIP protocol stack MUST communicate with the lower layers via defined interfaces. [REQ A.2]</p>
<p>In addition to the internal layer interfaces implemented by hardware and software resources within the Endpoint System’s boundary, an Endpoint System may also rely on the services of other Supporting Systems that are located outside of the Endpoint System but accessible through the Internet to perform their functions. This type of interaction requires a defined <strong>Protocol</strong>. </p>
<p>The distinction between an Interface and a Protocol is whether the systems communicating over the protocol represent different loci of control. For example, simply distributing the functions within a particular layer over the Internet — such as having some of the functions performed using cloud computing or web services—does not necessarily require a defined protocol if all of the functions are under the same locus of control. However an agreed protocol may be necessary if the communicating systems are under different loci of control. What is essential is delineating who has control over what in order to reason about trust relationships. </p>
<p>The four layer stack within an Endpoint System is defined in the following sections.</p>
<h3 class='ui small header'  id="72layer1trustsupport">7.2 Layer 1: Trust Support</h3>
<p>If a ToIP Endpoint System includes Trust Support Functions, then those functions MUST be included at Layer 1 of the Endpoint System. [REQ L1.1] The exact nature of the Trust Support Functions required by any particular Endpoint System may vary significantly depending on the Endpoint System’s physical manifestation and numerous other design goals (e.g. cost, location, convenience, power usage, reliability and so on). For example the Trust Support Functions required for a full-featured smartphone vs. a cloud server vs. an IoT thermostat may be very different. </p>
<p>Examples of Trust Support Functions designed to specifically support machine-to-machine trust (aka cryptographic trust or technical trust):</p>
<ul class='ui list' >
<li class='ui item' >Cryptographic hardware modules capable of generating good quality cryptographic key materials.</li>
<li class='ui item' >Sufficiently secure storage of secrets and cryptographic materials.</li>
<li class='ui item' >Sufficiently secure computing environment.</li>
<li class='ui item' >Sufficient communication functions for the intended deployment environment.</li>
</ul>
<p><em>NOTE: while this specification generally assumes the Internet as the common networking environment, Internet support is not strictly required. The ToIP stack may be implemented over any communication medium capable of supporting the defined protocols.</em></p>
<p>Examples of Trust Support Functions designed to specifically support human-to-human trust (aka business trust or legal trust) include:</p>
<ul class='ui list' >
<li class='ui item' >Identity binding mechanisms that associate a natural person to the Endpoint System itself, or to data artifacts on the Endpoint System such as identity claims or verifiable credentials. One of the strongest identity binding mechanisms is biometrics — physiological or behavioral characteristics that identify the individual (facial recognition, fingerprint readers, voice recognition, palm recognition, and so on). Layer 1 would provide the hardware and software support for registering, storing, and processing biometric primitives.</li>
<li class='ui item' >Hardware-based trust attestation systems, such as those incorporated within <a href="https://trustedcomputinggroup.org/resource/trusted-platform-module-tpm-summary/">Trusted Platform Modules</a>, and other confidential computing systems that can provide legally valid evidence of the security characteristics of a Layer 1 component.</li>
</ul>
<p>Diversity of implementations of Layer 1 Trust Support Functions is <em>intentional</em> and a key goal of the ToIP stack design.</p>
<p><em>NOTE: For functional, performance, security, or other reasons, a Layer 1 Trust Support Function may use a remote service in its implementation, e.g., a distributed ledger, distributed directory, distributed database, distributed file system, or distributed hash table. These systems are Supporting Systems to the Layer 1 implementation; they are not part of Layer 1 itself.</em></p>
<h3 class='ui small header'  id="73layer2trustspanning">7.3 Layer 2: Trust Spanning</h3>
<p>Layer 2 is the trust spanning layer of the ToIP stack. In keeping with Design Principle #3 (<a href="https://trustoverip.org/permalink/Design-Principles-for-the-ToIP-Stack-V1.0-2022-11-17.pdf">The Hourglass Model</a>), this means there is only one requirement for Layer 2: A ToIP Endpoint System MUST communicate with another ToIP Endpoint System using the ToIP Trust Spanning Protocol. [REQ L2.1] No other functions are required.</p>
<p>The requirements for the ToIP Trust Spanning Protocol are defined in <a href="#8-the-toip-trust-spanning-protocol">Section 8</a>.</p>
<h3 class='ui small header'  id="74layer3trusttasks">7.4 Layer 3: Trust Tasks</h3>
<p>Many applications may require more complex trust-building functions than the minimal set offered directly by the ToIP Trust Spanning Protocol. When one of these functions is reusable across multiple contexts that are separated in time, space, or perspective, we call it a Trust Task. Trust Tasks can be standardized as their own higher-level protocols at Layer 3 of the ToIP stack. </p>
<p>A Layer 3 Trust Task Protocol MUST communicate either over the Layer 2 ToIP Trust Spanning Protocol or over another Layer 3 Trust Task Protocol for all communications related to trust establishment between Endpoint Systems. [REQ L3.1] This is directly analogous to how TCP and UDP communicate over IP, and how HTTP communicates over TCP. A Layer 3 Trust Task MAY use other protocols, but only for other purposes (since short-circuiting Layer 2 when establishing trust with other Endpoint Systems would undermine the trust guarantees of the ToIP stack). [REQ L3.2]</p>
<p>Note that because Confidentiality and Privacy are optional for the Layer 2 ToIP Trust Spanning Protocol, the following requirement applies: A Layer 3 Trust Task Protocol intended to communicate private data SHOULD support Confidentiality and Privacy. [REQ L3.3]</p>
<p>There can be as many Trust Tasks Protocols as are needed by Layer 4 Trust Applications. Some examples of Trust Tasks include:</p>
<ul class='ui list' >
<li class='ui item' >Human authentication (as opposed to cryptographic authentication performed at Layer 2), including biometric authentication</li>
<li class='ui item' >Exchanges of verifiable credentials (issue, request, offer, present, revoke)</li>
<li class='ui item' >Provisioning, updating, and verification of digital identities</li>
<li class='ui item' >Consent management</li>
<li class='ui item' >Requesting and signing of digital documents</li>
<li class='ui item' >Secure messaging</li>
<li class='ui item' >Secure data sharing</li>
<li class='ui item' >Digital payment or value exchange in any form</li>
<li class='ui item' >Digital auctions</li>
<li class='ui item' >Digital notaries</li>
</ul>
<h3 class='ui small header'  id="75layer4trustapplications">7.5 Layer 4: Trust Applications</h3>
<p>Layer 4 is an open-ended application layer for any application that needs to engage in trusted interactions. Layer 4 Trust Applications MAY use any number of Layer 3 Trust Task Protocols. [REQ L4.1]. </p>
<p>If a Layer 4 Trust Application does not use a Layer 3 Trust Task Protocol, it MUST communicate with other Endpoint Systems using the Layer 2 Trust Spanning Protocol. [REQ L4.2]</p>
<p>Layer 4 is the layer where humans “touch” the ToIP stack, so this is where Design Principle #8 (<a href="https://trustoverip.org/permalink/Design-Principles-for-the-ToIP-Stack-V1.0-2022-11-17.pdf">Trust is Human</a>) and #14 (<a href="https://trustoverip.org/permalink/Design-Principles-for-the-ToIP-Stack-V1.0-2022-11-17.pdf">Trust and Technology have a Reciprocal Relationship</a>) come into play. The human experience of digital trust is so critical that Layer 4 has one more requirement: A Layer 4 Trust Application MUST support any ToIP-defined Trust Affordances relevant to that application. [REQ 4.3]</p>
<h2 class='ui medium header'  id="8thetoiptrustspanningprotocol">8. The ToIP Trust Spanning Protocol</h2>
<p><em>This section is normative.</em></p>
<h3 class='ui small header'  id="81overview">8.1 Overview</h3>
<p>This section describes the ToIP Trust Spanning Protocol required at Layer 2 to communicate between any two Endpoint Systems. The overall protocol operation is shown in Figure 9 below.</p>
<p><img src="/images/SpanningProtocol.png" alt="Overview of the ToIP Spanning Protocol" style="width:800px;"/></p>
<p><strong>Figure 9: Overview of the ToIP Spanning Protocol</strong></p>
<p>The main function of this protocol is to enable universal end-to-end communication among all Endpoint Systems using trusted messages. This architectural choice is based on the following considerations:</p>
<ul class='ui list' >
<li class='ui item' >Existing Internet, local network, and mesh network infrastructure already supports universal end-to-end communication through various types of transport mechanisms.</li>
<li class='ui item' >This form of communication should be able to be implemented on all common types of Endpoint Systems with minimum overhead and constraints.</li>
<li class='ui item' >Messaging-based communication is a least common denominator that provides sufficient foundation for building more complex trust functions at higher layers.</li>
</ul>
<p>This protocol is designed to be universal in the sense that all Endpoint Systems, regardless of their form factors or implementation methods, can communicate with each other using messages incorporating standard trust guarantees.</p>
<p>To achieve ubiquity, this protocol should be kept as simple as possible to ease implementation challenges and allow maximum flexibility on all variants of Endpoint Systems. Thus the requirements in the following sections are not only necessary but sufficient. Strong preference must be given not to add additional functions to this protocol unless they are universally beneficial. Strong preference must also be given to a single common protocol specification for maximum any-to-any interoperability. </p>
<p>A view of the ToIP protocol stack on an Endpoint System is shown in Figure 10. The component specification for the ToIP Trust Spanning Protocol therefore needs to specify:</p>
<ol>
<li class='ui item' >How to generate and maintain identifiers with the properties described in <a href="#64-toip-identifiers">Section 6.4</a>.</li>
<li class='ui item' >The common message format that meets the design goals described in <a href="#61-design-goals">Section 6.1</a>.</li>
<li class='ui item' >How lower layer transport protocol(s) can be used to deliver messages between Endpoint Systems.</li>
<li class='ui item' >Any required support from ToIP Layer 1.</li>
</ol>
<p><img src="/images/StackOnEndpoint.png" alt="A view of the ToIP protocol stack on an Endpoint System" style="width:800px;"/></p>
<p><strong>Figure 10: A view of the ToIP protocol stack on an Endpoint System</strong></p>
<p>The following sections enumerate the requirements in each of these four areas.</p>
<h3 class='ui small header'  id="82identifiers">8.2 Identifiers</h3>
<h3 class='ui small header'  id="83messages">8.3 Messages</h3>
<h3 class='ui small header'  id="84routing">8.4 Routing</h3>
<h3 class='ui small header'  id="85interfacetolayer1">8.5 Interface to Layer 1</h3>
<h2 class='ui medium header'  id="9intermediarysystems">9. Intermediary Systems</h2>
<h2 class='ui medium header'  id="10supportingsystems">10. Supporting Systems</h2>
<h3 class='ui small header'  id="101overview">10.1 Overview</h3>
<h3 class='ui small header'  id="102example1">10.2 Example 1</h3>
<h3 class='ui small header'  id="103example2">10.3 Example 2</h3>
<h3 class='ui small header'  id="104generalization">10.4 Generalization</h3>
<h2 class='ui medium header'  id="11endpointsysteminteroperability">11. Endpoint System Interoperability</h2>
<h3 class='ui small header'  id="111interoperabilitybetweenendpointswithdecentralizedidentifiers">11.1 Interoperability between Endpoints with Decentralized Identifiers</h3>
<h3 class='ui small header'  id="112interoperabilitybetweenendpointswithdecentralizedandotheridentifiers">11.2 Interoperability between Endpoints with Decentralized and Other Identifiers</h3>
<h2 class='ui medium header'  id="12integrationwiththetoipgovernancestack">12. Integration with the ToIP Governance Stack</h2>
<h2 class='ui medium header'  id="13references">13. References</h2>
<h2 class='ui medium header'  id="aboutthetoipfoundation">About the ToIP Foundation</h2>
<h2 class='ui medium header'  id="appendixaconsolidatedrequirements">Appendix A: Consolidated Requirements</h2>
<h2 class='ui medium header'  id="appendixbmappingofexistingtechnologiesintothetoipstack">Appendix B: Mapping of Existing Technologies into the ToIP Stack</h2>

</body>
</html>
